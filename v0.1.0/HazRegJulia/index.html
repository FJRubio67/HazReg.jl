<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>HazReg.jl: Parametric Hazard-based regression models for survival data · HazReg.jl</title><meta name="title" content="HazReg.jl: Parametric Hazard-based regression models for survival data · HazReg.jl"/><meta property="og:title" content="HazReg.jl: Parametric Hazard-based regression models for survival data · HazReg.jl"/><meta property="twitter:title" content="HazReg.jl: Parametric Hazard-based regression models for survival data · HazReg.jl"/><meta name="description" content="Documentation for HazReg.jl."/><meta property="og:description" content="Documentation for HazReg.jl."/><meta property="twitter:description" content="Documentation for HazReg.jl."/><meta property="og:url" content="https://FJRubio67.github.io/HazReg.jl/HazRegJulia/"/><meta property="twitter:url" content="https://FJRubio67.github.io/HazReg.jl/HazRegJulia/"/><link rel="canonical" href="https://FJRubio67.github.io/HazReg.jl/HazRegJulia/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">HazReg.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">HazReg.jl</a></li><li><a class="tocitem" href="../EW/">Exponentiated Weibull Distribution</a></li><li><a class="tocitem" href="../GenGamma/">Generalised Gamma Distribution</a></li><li class="is-active"><a class="tocitem" href>HazReg.jl: Parametric Hazard-based regression models for survival data</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Models"><span>Models</span></a></li><li><a class="tocitem" href="#General-Hazard-model"><span>General Hazard model</span></a></li><li><a class="tocitem" href="#Accelerated-Failure-Time-(AFT)-model"><span>Accelerated Failure Time (AFT) model</span></a></li><li><a class="tocitem" href="#Proportional-Hazards-(PH)-model"><span>Proportional Hazards (PH) model</span></a></li><li><a class="tocitem" href="#Accelerated-Hazards-(AH)-model"><span>Accelerated Hazards (AH) model</span></a></li><li class="toplevel"><a class="tocitem" href="#Available-baseline-hazards"><span>Available baseline hazards</span></a></li><li class="toplevel"><a class="tocitem" href="#Illustrative-example:-Julia-code"><span>Illustrative example: Julia code</span></a></li><li><a class="tocitem" href="#Data-preparation"><span>Data preparation</span></a></li><li><a class="tocitem" href="#Model-fit-and-MLEs"><span>Model fit and MLEs</span></a></li><li><a class="tocitem" href="#Model-Comparison"><span>Model Comparison</span></a></li><li><a class="tocitem" href="#Baseline-hazards-for-GH-models"><span>Baseline hazards for GH models</span></a></li><li><a class="tocitem" href="#Best-model-summaries"><span>Best-model summaries</span></a></li></ul></li><li><a class="tocitem" href="../OtherHazards/">Some hazard functions in Julia</a></li><li><a class="tocitem" href="../PGW/">Power Generalised Weibull Distribution</a></li><li><a class="tocitem" href="../references/">References</a></li><li><a class="tocitem" href="../simGHJulia/">Julia simGH: simulating times to event from a general hazard structure</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>HazReg.jl: Parametric Hazard-based regression models for survival data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>HazReg.jl: Parametric Hazard-based regression models for survival data</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FJRubio67/HazReg.jl/blob/main/docs/src/HazRegJulia.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="HazReg.jl:-Parametric-Hazard-based-regression-models-for-survival-data"><a class="docs-heading-anchor" href="#HazReg.jl:-Parametric-Hazard-based-regression-models-for-survival-data">HazReg.jl: Parametric Hazard-based regression models for survival data</a><a id="HazReg.jl:-Parametric-Hazard-based-regression-models-for-survival-data-1"></a><a class="docs-heading-anchor-permalink" href="#HazReg.jl:-Parametric-Hazard-based-regression-models-for-survival-data" title="Permalink"></a></h1><h1 id="Models"><a class="docs-heading-anchor" href="#Models">Models</a><a id="Models-1"></a><a class="docs-heading-anchor-permalink" href="#Models" title="Permalink"></a></h1><p>The <code>HazReg.jl</code> Julia package implements the following parametric hazard-based regression models for (overall) survival data.</p><ul><li><p>General Hazard (GH) model [<a href="../references/#chen:2001">2</a>] [<a href="../references/#rubio:2019">3</a>].</p></li><li><p>Accelerated Failure Time (AFT) model [<a href="../references/#kalbfleisch:2011">4</a>].</p></li><li><p>Proportional Hazards (PH) model [<a href="../references/#cox:1972">5</a>].</p></li><li><p>Accelerated Hazards (AH) model [<a href="../references/#chen:2000">6</a>].</p></li></ul><p>These models are fitted using the Julia package <code>Optim</code> (methods included: &quot;NM&quot; (NelderMead), &quot;N&quot; (Newton), &quot;LBFGS&quot; (LBFGS), &quot;CG&quot; (ConjugateGradient), &quot;GD&quot; (GradientDescent)). Thus, the user needs to specify the initial points and to check the convergence of the optimisation step, as usual.</p><p>A description of these hazard models is presented below as well as the available baseline hazards.</p><h2 id="General-Hazard-model"><a class="docs-heading-anchor" href="#General-Hazard-model">General Hazard model</a><a id="General-Hazard-model-1"></a><a class="docs-heading-anchor-permalink" href="#General-Hazard-model" title="Permalink"></a></h2><p>The GH model is formulated in terms of the hazard structure </p><p class="math-container">\[h(t; \alpha, \beta, \theta, {\bf x}) = h_0\left(t  \exp\{\tilde{\bf x}^{\top}\alpha\}; \theta\right) \exp\{{\bf x}^{\top}\beta\}.\]</p><p>where <span>${\bf x}\in{\mathbb R}^p$</span> are the covariates that affect the hazard level; <span>$\tilde{\bf x} \in {\mathbb R}^q$</span> are the covariates the affect the time level (typically <span>$\tilde{\bf x} \subset {\bf x}$</span>); <span>$\alpha \in {\mathbb R}^q$</span> and <span>$\beta \in {\mathbb R}^p$</span> are the regression coefficients; and <span>$\theta \in \Theta$</span> is the vector of parameters of the baseline hazard <span>$h_0(\cdot)$</span>.</p><p>This hazard structure leads to an identifiable model as long as the baseline hazard is not a hazard associated to a member of the Weibull family of distributions [<a href="../references/#chen:2001">2</a>].</p><h2 id="Accelerated-Failure-Time-(AFT)-model"><a class="docs-heading-anchor" href="#Accelerated-Failure-Time-(AFT)-model">Accelerated Failure Time (AFT) model</a><a id="Accelerated-Failure-Time-(AFT)-model-1"></a><a class="docs-heading-anchor-permalink" href="#Accelerated-Failure-Time-(AFT)-model" title="Permalink"></a></h2><p>The AFT model is formulated in terms of the hazard structure </p><p class="math-container">\[h(t; \beta, \theta, {\bf x}) = h_0\left(t  \exp\{{\bf x}^{\top}\beta\}; \theta\right) \exp\{{\bf x}^{\top}\beta\}.\]</p><p>where <span>${\bf x}\in{\mathbb R}^p$</span> are the available covariates; <span>$\beta \in {\mathbb R}^p$</span> are the regression coefficients; and <span>$\theta \in \Theta$</span> is the vector of parameters of the baseline hazard <span>$h_0(\cdot)$</span>.</p><h2 id="Proportional-Hazards-(PH)-model"><a class="docs-heading-anchor" href="#Proportional-Hazards-(PH)-model">Proportional Hazards (PH) model</a><a id="Proportional-Hazards-(PH)-model-1"></a><a class="docs-heading-anchor-permalink" href="#Proportional-Hazards-(PH)-model" title="Permalink"></a></h2><p>The PH model is formulated in terms of the hazard structure </p><p class="math-container">\[h(t; \beta, \theta, {\bf x}) = h_0\left(t ; \theta\right) \exp\{{\bf x}^{\top}\beta\}.\]</p><p>where <span>${\bf x}\in{\mathbb R}^p$</span> are the available covariates; <span>$\beta \in {\mathbb R}^p$</span> are the regression coefficients; and <span>$\theta \in \Theta$</span> is the vector of parameters of the baseline hazard <span>$h_0(\cdot)$</span>.</p><h2 id="Accelerated-Hazards-(AH)-model"><a class="docs-heading-anchor" href="#Accelerated-Hazards-(AH)-model">Accelerated Hazards (AH) model</a><a id="Accelerated-Hazards-(AH)-model-1"></a><a class="docs-heading-anchor-permalink" href="#Accelerated-Hazards-(AH)-model" title="Permalink"></a></h2><p>The AH model is formulated in terms of the hazard structure </p><p class="math-container">\[h(t; \alpha, \theta, \tilde{\bf x}) = h_0\left(t \exp\{\tilde{\bf x}^{\top}\alpha\}; \theta\right) .\]</p><p>where <span>$\tilde{\bf x}\in{\mathbb R}^q$</span> are the available covariates; <span>$\alpha \in {\mathbb R}^q$</span> are the regression coefficients; and <span>$\theta \in \Theta$</span> is the vector of parameters of the baseline hazard <span>$h_0(\cdot)$</span>.</p><h1 id="Available-baseline-hazards"><a class="docs-heading-anchor" href="#Available-baseline-hazards">Available baseline hazards</a><a id="Available-baseline-hazards-1"></a><a class="docs-heading-anchor-permalink" href="#Available-baseline-hazards" title="Permalink"></a></h1><p>The current version of the <code>HazReg.jl</code> Julia package implements the following parametric baseline hazards for the models discussed in the previous section.</p><ul><li><p><a href="http://rpubs.com/FJRubio/PGW">Power Generalised Weibull</a> (<code>PGW</code>)   distribution.</p></li><li><p><a href="http://rpubs.com/FJRubio/EWD">Exponentiated Weibull</a> (<code>EW</code>)   distribution.</p></li><li><p><a href="http://rpubs.com/FJRubio/GG">Generalised Gamma</a> (<code>GenGamma</code>) distribution.</p></li><li><p><a href="https://en.wikipedia.org/wiki/Gamma_distribution">Gamma</a> (<code>Gamma</code>)   distribution.</p></li><li><p><a href="https://en.wikipedia.org/wiki/Log-normal_distribution">Lognormal</a>   (<code>LogNormal</code>) distribution.</p></li><li><p><a href="https://en.wikipedia.org/wiki/Log-logistic_distribution">Log-logistic</a>   (<code>LogLogistic</code>) distribution.</p></li><li><p><a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull</a> (<code>Weibull</code>)   distribution. (only for AFT, PH, and AH models)</p></li></ul><p>All positive parameters are transformed into the real line using a <code>log</code> link (reparameterisation).</p><h1 id="Illustrative-example:-Julia-code"><a class="docs-heading-anchor" href="#Illustrative-example:-Julia-code">Illustrative example: Julia code</a><a id="Illustrative-example:-Julia-code-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrative-example:-Julia-code" title="Permalink"></a></h1><p>In this example, we analyse the <code>LeukSurv</code> data set from the R package <code>spBayesSurv</code>. This data set contains information about the survival of acute myeloid leukemia in 1,043 patients.</p><p>For the GH model, we consider the hazard level covariates (<span>${\bf x}$</span>) age (standardised), sex, wbc (white blood cell count at diagnosis, standardised), and tpi (the Townsend score, standardised); and the time level covariates (<span>${\bf x}$</span>) age (standardised), wbc (white blood cell count at diagnosis, standardised), and tpi (the Townsend score, standardised). For the PH, AFT, and AH models, we consider the covariates age (standardised), sex, wbc (white blood cell count at diagnosis, standardised), and tpi (the Townsend score, standardised).</p><p>For illustration, we fit the 4 models with both (3-parameter) PGW and (2-parameter) LL baseline hazard. In addition, we fit the GH model with <code>GenGamma</code>, <code>EW</code>, <code>LogNormal</code>, <code>LogLogistic</code>, and <code>Gamma</code> baseline hazards. We compare these models in terms of AIC (BIC can be used as well). We summarise the best selected model with the available tools in this package.</p><p>See also: </p><ul><li><p><a href="https://github.com/FJRubio67/HazReg.jl">HazReg.jl Julia Package</a> </p></li><li><p><a href="https://github.com/FJRubio67/GHSurv">HazReg</a>, for an R implementation.</p></li></ul><h2 id="Data-preparation"><a class="docs-heading-anchor" href="#Data-preparation">Data preparation</a><a id="Data-preparation-1"></a><a class="docs-heading-anchor-permalink" href="#Data-preparation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Distributions
using Random
using StatsBase
using Optim
using LinearAlgebra
using SpecialFunctions
using ForwardDiff


using HazReg
using Plots
using PrettyTables
using DataFrames
using NamedArrays
using CSV
using Survival

#= Data =#
df = CSV.File(joinpath(@__DIR__,&quot;..&quot;,&quot;src&quot;,&quot;assets&quot;,&quot;LeukSurv.csv&quot;));

#= Design matrix for hazard level effects =#
des = hcat( standardise(df.age), df.sex, standardise(df.wbc), standardise(df.tpi) );

#= Design matrix for time level effects =#
des_t = hcat( standardise(df.age), standardise(df.wbc), standardise(df.tpi) );

#= Vital status =#
status = collect(Bool,(df.cens));

#= Survival times =#
times = df.time/365.25 ;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1043-element Vector{Float64}:
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  0.0027378507871321013
  ⋮
 12.583162217659138
 12.731006160164272
 12.829568788501026
 12.985626283367557
 13.05681040383299
 13.127994524298426
 13.475701574264203
 13.593429158110883
 13.626283367556468</code></pre><h2 id="Model-fit-and-MLEs"><a class="docs-heading-anchor" href="#Model-fit-and-MLEs">Model fit and MLEs</a><a id="Model-fit-and-MLEs-1"></a><a class="docs-heading-anchor-permalink" href="#Model-fit-and-MLEs" title="Permalink"></a></h2><pre><code class="language-julia hljs"># PGWGH
OPTPGWGH = GHMLE(init = fill(0.0, 3 + size(des_t)[2] + size(des)[2]), times = times,
            status = status, hstr = &quot;GH&quot;, dist = &quot;PGW&quot;,
            des = des, des_t = des_t, method = &quot;NM&quot;, maxit = 1000)

# PGWAFT
OPTPGWAFT = GHMLE(init = fill(0.0, 3 + size(des)[2]), times = times,
                  status = status, hstr = &quot;AFT&quot;, dist = &quot;PGW&quot;,
                  des = des, des_t = nothing, method = &quot;NM&quot;, maxit = 1000)

# PGWPH
OPTPGWPH = GHMLE(init = fill(0.0, 3 +size(des)[2]), times = times,
                 status = status, hstr = &quot;PH&quot;, dist = &quot;PGW&quot;,
                 des = des, des_t = nothing, method = &quot;NM&quot;, maxit = 1000)

# PGWAH
OPTPGWAH = GHMLE(init = fill(0.0, 3 + size(des_t)[2] ), times = times,
                 status = status, hstr = &quot;AH&quot;, dist = &quot;PGW&quot;,
                 des_t = des_t, des = nothing, method = &quot;NM&quot;, maxit = 1000)


# LLGH
OPTLLGH = GHMLE(init = fill(0.0, 2 + size(des_t)[2] + size(des)[2]), times = times,
                status = status, hstr = &quot;GH&quot;, dist = &quot;LogLogistic&quot;,
                des = des, des_t = des_t, method = &quot;NM&quot;, maxit = 1000)

# LLAFT
OPTLLAFT = GHMLE(init = fill(0.0, 2 + size(des)[2]), times = times,
                  status = status, hstr = &quot;AFT&quot;, dist = &quot;LogLogistic&quot;,
                  des = des, des_t = nothing, method = &quot;NM&quot;, maxit = 1000)

# LLPH
OPTLLPH = GHMLE(init = fill(0.0, 2 + size(des)[2]), times = times,
                status = status, hstr = &quot;PH&quot;, dist = &quot;LogLogistic&quot;,
                des = des, des_t = nothing, method = &quot;NM&quot;, maxit = 1000)

# LLAH
OPTLLAH = GHMLE(init = fill(0.0, 2 + size(des_t)[2]), times = times,
                status = status, hstr = &quot;AH&quot;, dist = &quot;LogLogistic&quot;,
                des = nothing, des_t = des_t, method = &quot;NM&quot;, maxit = 1000)


# EWGH
OPTEWGH = GHMLE(init = fill(0.0, 3 + size(des_t)[2] + size(des)[2]), times = times,
                status = status, hstr = &quot;GH&quot;, dist = &quot;EW&quot;,
                des = des, des_t = des_t, method = &quot;NM&quot;, maxit = 1000)

# GGGH
OPTGGGH = GHMLE(init = fill(0.0, 3 + size(des_t)[2] + size(des)[2]), times = times,
                status = status, hstr = &quot;GH&quot;, dist = &quot;GenGamma&quot;,
                des = des, des_t = des_t, method = &quot;NM&quot;, maxit = 1000)

# LNGH
OPTLNGH = GHMLE(init = fill(0.0, 2 + size(des_t)[2] + size(des)[2]), times = times,
                status = status, hstr = &quot;GH&quot;, dist = &quot;LogNormal&quot;,
                des = des, des_t = des_t, method = &quot;NM&quot;, maxit = 1000)

# GGH
OPTGGH = GHMLE(init = fill(0.0, 2 + size(des_t)[2] + size(des)[2]), times = times,
               status = status, hstr = &quot;GH&quot;, dist = &quot;Gamma&quot;,
               des = des, des_t = des_t, method = &quot;N&quot;, maxit = 1000)

# MLEs in the original parameterisations
MLEPGWGH = [exp(OPTPGWGH[1].minimizer[j]) for j in 1:3]
append!(MLEPGWGH, OPTPGWGH[1].minimizer[4:end])

MLEEWGH = [exp(OPTEWGH[1].minimizer[j]) for j in 1:3]
append!(MLEEWGH, OPTEWGH[1].minimizer[4:end])

MLEEWGH = [exp(OPTEWGH[1].minimizer[j]) for j in 1:3]
append!(MLEEWGH, OPTEWGH[1].minimizer[4:end])

MLEGGGH = [exp(OPTGGGH[1].minimizer[j]) for j in 1:3]
append!(MLEGGGH, OPTGGGH[1].minimizer[4:end])

MLEGGH = [exp(OPTGGH[1].minimizer[j]) for j in 1:2]
append!(MLEGGH, OPTGGH[1].minimizer[3:end])

MLELNGH = [OPTLNGH[1].minimizer[1], exp(OPTLNGH[1].minimizer[2]), OPTLNGH[1].minimizer[3:end]...]

MLELLGH = [OPTLLGH[1].minimizer[1], exp(OPTLLGH[1].minimizer[2]), OPTLLGH[1].minimizer[3:end]...]

MLES = hcat(MLEPGWGH, MLEEWGH, MLEGGGH, [MLEGGH[1], MLEGGH[2], nothing, MLEGGH[3:end]...],
            [MLELNGH[1], MLELNGH[2], nothing, MLELNGH[3:end]...],[MLELLGH[1], MLELLGH[2], nothing, MLELLGH[3:end]...])

MLES = DataFrame(MLES, :auto)

rename!( MLES, [&quot;PGWGH&quot;, &quot;EWGH&quot;, &quot;GGGH&quot;, &quot;GGH&quot;, &quot;LNGH&quot;, &quot;LLGH&quot;] )

# MLEs for GH models
println(MLES)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">10×6 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> PGWGH      EWGH       GGGH        GGH         LNGH       LLGH      </span>
     │<span class="sgr90"> Union…     Union…     Union…      Union…      Union…     Union…    </span>
─────┼────────────────────────────────────────────────────────────────────
   1 │ 0.0950152  0.0106152  0.00658277  0.48821     -0.729543  -0.718369
   2 │ 1.00611    0.232759   1.06396     4.11739     1.98069    1.12585
   3 │ 3.47407    7.64616    0.282329   <span class="sgr90">                                  </span>
   4 │ 0.91133    0.868762   1.22694     -0.800448   0.852858   0.828229
   5 │ 0.897534   0.925936   1.19993     -0.510837   0.788362   0.740527
   6 │ 0.413299   0.44666    0.862072    -0.592114   0.369539   0.41986
   7 │ 0.978584   0.956015   1.09682     0.338275    0.95762    0.948681
   8 │ 0.077424   0.0745275  0.0760824   0.147894    0.0743278  0.0720056
   9 │ 0.681224   0.69978    0.80311     0.00433901  0.630381   0.609399
  10 │ 0.302625   0.319423   0.494054    -0.115218   0.286803   0.31509</code></pre><h2 id="Model-Comparison"><a class="docs-heading-anchor" href="#Model-Comparison">Model Comparison</a><a id="Model-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Comparison" title="Permalink"></a></h2><pre><code class="language-julia hljs"># AIC for models with PGW baseline hazard
AICPGWGH = 2*OPTPGWGH[1].minimum + 2*length(OPTPGWGH[1].minimizer)
AICPGWAFT = 2*OPTPGWAFT[1].minimum + 2*length(OPTPGWAFT[1].minimizer)
AICPGWPH = 2*OPTPGWPH[1].minimum + 2*length(OPTPGWPH[1].minimizer)
AICPGWAH = 2*OPTPGWAH[1].minimum + 2*length(OPTPGWAH[1].minimizer)

# AICs for models with LL baseline hazard
AICLLGH = 2*OPTLLGH[1].minimum + 2*length(OPTLLGH[1].minimizer)
AICLLAFT = 2*OPTLLAFT[1].minimum + 2*length(OPTLLAFT[1].minimizer)
AICLLPH = 2*OPTLLPH[1].minimum + 2*length(OPTLLPH[1].minimizer)
AICLLAH = 2*OPTLLAH[1].minimum + 2*length(OPTLLAH[1].minimizer)

# AICs for GH models with GG, EW, LN, and G hazards
AICGGGH = 2*OPTGGGH[1].minimum + 2*length(OPTGGGH[1].minimizer)
AICEWGH = 2*OPTEWGH[1].minimum + 2*length(OPTEWGH[1].minimizer)
AICLNGH = 2*OPTLNGH[1].minimum + 2*length(OPTLNGH[1].minimizer)
AICGGH = 2*OPTGGH[1].minimum + 2*length(OPTGGH[1].minimizer)



# All AICs
AICs = [AICPGWGH, AICPGWAFT, AICPGWPH, AICPGWAH,
          AICLLGH, AICLLAFT, AICLLPH, AICLLAH,
          AICGGGH, AICEWGH, AICLNGH, AICGGH]

println(AICs)

# Best model: LLGH
argmin(AICs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5</code></pre><h2 id="Baseline-hazards-for-GH-models"><a class="docs-heading-anchor" href="#Baseline-hazards-for-GH-models">Baseline hazards for GH models</a><a id="Baseline-hazards-for-GH-models-1"></a><a class="docs-heading-anchor-permalink" href="#Baseline-hazards-for-GH-models" title="Permalink"></a></h2><pre><code class="language-julia hljs"># Fitted baseline hazard functions for GH models
function PGWGHhaz(t::Float64)
    out = hPGW(t, MLEPGWGH[1], MLEPGWGH[2], MLEPGWGH[3])
    return out
end

function EWGHhaz(t::Float64)
    out = hEW(t, MLEEWGH[1], MLEEWGH[2], MLEEWGH[3])
    return out
end

function GGGHhaz(t::Float64)
    out = hGenGamma(t, MLEGGGH[1], MLEGGGH[2], MLEGGGH[3])
    return out
end

function GGHhaz(t::Float64)
    out = hGamma(t, MLEGGH[1], MLEGGH[2])
    return out
end

function LNGHhaz(t::Float64)
    out = hLogNormal(t, MLELNGH[1], MLELNGH[2])
    return out
end

function LLGHhaz(t::Float64)
    out = hLogNormal(t, MLELLGH[1], MLELLGH[2])
    return out
end

# Note that the baseline hazards associated to the top models look similar
plot(t -&gt; PGWGHhaz(t),
      xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;&quot;,
    xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
    xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
    xguidefontsize=18, yguidefontsize=18, linewidth=3,
    linecolor = &quot;blue&quot;, ylims = (0,4))

plot!(t -&gt; EWGHhaz(t),
   xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;&quot;,
  xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
  xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
  xguidefontsize=18, yguidefontsize=18, linewidth=3,
  linecolor = &quot;blue&quot;, ylims = (0,4), linestyle=:dash)

plot!(t -&gt; GGGHhaz(t),
   xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;&quot;,
  xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
  xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
  xguidefontsize=18, yguidefontsize=18, linewidth=3,
  linecolor = &quot;blue&quot;, ylims = (0,4), linestyle=:dot)

plot!(t -&gt; GGHhaz(t),
   xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;&quot;,
  xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
  xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
  xguidefontsize=18, yguidefontsize=18, linewidth=3,
  linecolor = &quot;blue&quot;, ylims = (0,4), linestyle=:dashdot)

plot!(t -&gt; LNGHhaz(t),
      xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;&quot;,
    xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
    xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
    xguidefontsize=18, yguidefontsize=18, linewidth=3,
    linecolor = &quot;blue&quot;, ylims = (0,4), linestyle=:dashdotdot)

plot!(t -&gt; LLGHhaz(t),
    xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;&quot;,
  xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
  xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
  xguidefontsize=18, yguidefontsize=18, linewidth=3,
  linecolor = &quot;red&quot;, ylims = (0,4), linestyle=:solid)</code></pre><img src="19d31d95.svg" alt="Example block output"/><h2 id="Best-model-summaries"><a class="docs-heading-anchor" href="#Best-model-summaries">Best-model summaries</a><a id="Best-model-summaries-1"></a><a class="docs-heading-anchor-permalink" href="#Best-model-summaries" title="Permalink"></a></h2><pre><code class="language-julia hljs"># MLE in the original parameterisation
MLE = MLELLGH

println(MLE)

# 95% Confidence intervals under the reparameterisation
CI = ConfInt(FUN = OPTLLGH[2], MLE = OPTLLGH[1].minimizer, level = 0.95)

CI = DataFrame(CI, :auto)

rename!( CI, [&quot;Lower&quot;, &quot;Upper&quot;] )

println(CI)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[-0.7183693784128291, 1.1258507232839738, 0.8282291818977023, 0.7405270729888672, 0.41985953386652336, 0.9486806545482077, 0.07200557173840726, 0.6093993558633369, 0.3150899846867708]
<span class="sgr1">9×2 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> Lower       Upper     </span>
     │<span class="sgr90"> Float64     Float64   </span>
─────┼───────────────────────
   1 │ -0.883692   -0.553047
   2 │  0.0596398   0.177438
   3 │  0.528404    1.12805
   4 │  0.492198    0.988857
   5 │  0.119745    0.719974
   6 │  0.790656    1.10671
   7 │ -0.0579488   0.20196
   8 │  0.446133    0.772666
   9 │  0.149466    0.480714</code></pre><pre><code class="language-julia hljs"># Fitted baseline hazard function
plot(t -&gt; LLGHhaz(t),
    xlabel = &quot;Time (years)&quot;, ylabel = &quot;Baseline Hazard&quot;, title = &quot;Best Model&quot;,
  xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
  xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
  xguidefontsize=18, yguidefontsize=18, linewidth=3,
  linecolor = &quot;red&quot;, ylims = (0,4), linestyle=:solid)

# Average population survival function and KM estimator

function pop_surv(t::Float64)
  p0 = size(des_t)[2]
  p1 = size(des)[2]
  theta1 = MLE[1]
  theta2 = MLE[2]
  alpha = MLE[3:(2+p0)]
  beta = MLE[(3+p0):(2+p0+p1)]
  x_alpha = des_t * alpha
  x_dif = des * beta - x_alpha
  out = mean( exp.( - chLogLogistic(t*exp.(x_alpha), theta1, theta2).* exp.(x_dif)  )  )
  return out
end


# Kaplan-Meier estimator
km_fit = fit(KaplanMeier, times, df.cens)

ktimes = sort(unique(times))
ksurvival_probs = km_fit.survival

# Comparison
plot(ktimes, ksurvival_probs,
    xlabel = &quot;Time (years)&quot;, ylabel = &quot;Population Survival&quot;, title = &quot;Best Model&quot;,
  xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
  xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
  xguidefontsize=18, yguidefontsize=18, linewidth=3,
  linecolor = &quot;gray&quot;, ylims = (0,1), linestyle=:solid)

plot!(t -&gt; pop_surv(t),
  xlabel = &quot;Time (years)&quot;, ylabel = &quot;Population Survival&quot;, title = &quot;Best Model&quot;,
xlims = (0.0001,maximum(times)),   xticks = 0:1:maximum(times), label = &quot;&quot;,
xtickfont = font(16, &quot;Courier&quot;),  ytickfont = font(16, &quot;Courier&quot;),
xguidefontsize=18, yguidefontsize=18, linewidth=3,
linecolor = &quot;black&quot;, ylims = (0,1), linestyle=:solid)</code></pre><img src="0ce5b9fb.svg" alt="Example block output"/><pre><code class="language-julia hljs"># Confidence intervals for the survival function based on a normal approximation
# at specific time points t0

# Hessian and asymptotic covariance matrix
HESS = ForwardDiff.hessian(OPTLLGH[2], OPTLLGH[1].minimizer);
Sigma = inv(HESS);

#=
A &quot;hackish&quot; workaround to a bug in ForwardDiff, which may
produce non-symmetric hessian matrices.
Here, I am replacing the lower diagonal of Sigma by its
upper diagonal
=#
ps = size(Sigma, 1)
for i in 1:ps-1
    for j in i+1:ps
        Sigma[i, j] = Sigma[j, i]
    end
end


# Reparameterised MLE
r_MLE = OPTLLGH[1].minimizer;


# The function to obtain approximate CIs based on Monte Carlo simulations
# from the asymptotic normal distribution of the MLEs
# t0 : time where the confidence interval will be calculated
# level : confidence level
# nmc : number of Monte Carlo iterations

function ConfIntSurv(t0::Float64, level::Float64, nmc::Int64)
    p0 = size(des_t)[2]
    p1 = size(des)[2]
    mc = fill(0.0, nmc)
    function S_par(par::Vector{Float64})

        outs = mean( exp.( - chLogLogistic(t0.*exp.(des_t * par[3:(2+p0)]), par[1], par[2]) .*
                                        exp.( des * par[(3+p0):(2+p0+p1)].- des_t * par[3:(2+p0)])  )  )
                                        return outs
    end

    for i in 1:nmc
      mv_normal = MvNormal(r_MLE, Sigma)
      val = rand(mv_normal, 1)
      val1 = [val[1],exp(val[2]),val[3:end]...]
      mc[i] = S_par(val1)
    end

    L = quantile(mc,(1-level)*0.5)
    U = quantile(mc,(1+level)*0.5)

    M = S_par(MLE)

    return [L,M,U]
end



# times for CIs calculations
timesCI = [1.0,2.5,5,7.5,10,12.5];

CIS = zeros(length(timesCI), 4);

for k in 1:length(timesCI)
CIS[k,:] = vcat(timesCI[k], ConfIntSurv(timesCI[k],0.95,10000))
end

CIS = DataFrame(CIS, :auto);

rename!( CIS, [&quot;year&quot;,&quot;lower&quot;,&quot;population survival&quot;,&quot;upper&quot;] );

println(CIS)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">6×4 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> year     lower      population survival  upper     </span>
     │<span class="sgr90"> Float64  Float64    Float64              Float64   </span>
─────┼────────────────────────────────────────────────────
   1 │     1.0  0.33616              0.356815   0.379864
   2 │     2.5  0.200877             0.219102   0.240349
   3 │     5.0  0.127632             0.142754   0.161195
   4 │     7.5  0.0954786            0.108917   0.126327
   5 │    10.0  0.0767322            0.0892138  0.105322
   6 │    12.5  0.0644996            0.0761296  0.0916144</code></pre><div class="citation noncanonical"><dl><dt>[2]</dt><dd><div>Y. Chen and N. Jewell. <em>On a general class of semiparametric hazards regression models</em>. Biometrika <strong>88</strong>, 687–702 (2001).</div></dd><dt>[3]</dt><dd><div>F. Rubio, L. Remontet, N. Jewell and A. Belot. <em>On a general structure for hazard-based regression models: an application to population-based cancer research</em>. Statistical Methods in Medical Research <strong>28</strong>, 2404–2417 (2019).</div></dd><dt>[4]</dt><dd><div>J. Kalbfleisch and R. Prentice. <em>The statistical analysis of failure time data</em> (John Wiley &amp; Sons, 2011).</div></dd><dt>[5]</dt><dd><div>D. Cox. <em>Regression models and life-tables</em>. Journal of the Royal Statistical Society: Series B (Methodological) <strong>34</strong>, 187–202 (1972).</div></dd><dt>[6]</dt><dd><div>Y. Chen and M. Wang. <em>Analysis of accelerated hazards models</em>. Journal of the American Statistical Association <strong>95</strong>, 608–618 (2000).</div></dd></dl></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../GenGamma/">« Generalised Gamma Distribution</a><a class="docs-footer-nextpage" href="../OtherHazards/">Some hazard functions in Julia »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Monday 18 March 2024 18:57">Monday 18 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
